<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multi-KI Aktien & Krypto Dashboard – CHF</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
<style>
body{background:#0f172a;color:#e5e7eb;font-family:Arial,sans-serif;margin:0;padding:15px}
h1{text-align:center;font-size:1.5rem;margin-bottom:2px}
.subtitle{text-align:center;color:#94a3b8;font-size:0.9rem;margin-bottom:8px}
.controls{display:flex;justify-content:center;gap:8px;flex-wrap:wrap;margin:12px 0}
select,button{background:#020617;color:#e5e7eb;border:1px solid #22c55e;padding:8px 12px;border-radius:6px;font-size:0.85rem}
button:hover{background:#22c55e;color:#020617;cursor:pointer}
.status{text-align:center;margin:10px;font-weight:bold;font-size:0.9rem}
canvas{max-width:100%;margin:18px auto;display:block;background:#020617;border-radius:10px}
.scrollable-table{max-height:320px;overflow-y:auto;margin-top:10px}
table{width:100%;border-collapse:collapse;font-size:0.85rem;margin-top:10px}
th,td{border:1px solid #22c55e;padding:6px;text-align:center}
.buy{color:#22c55e;font-weight:bold}
.sell{color:#ef4444;font-weight:bold}
.hold{color:#facc15;font-weight:bold}
.warning{color:#f87171;font-weight:bold}
.conf{color:#38bdf8;font-weight:bold}
.footer{text-align:center;margin-top:14px;font-size:0.7rem;color:#94a3b8}
progress{border-radius:5px;width:80%;height:18px}
.chart-panel{width:100%;max-width:100%;height:320px;margin-bottom:20px}
.table-panel{width:100%;max-width:100%;margin-top:10px}
.progress-container{width:80%;margin:0 auto;text-align:center}
.bestKI{background-color:#22c55e33}
#currentPrice{margin:8px 0;font-weight:bold;text-align:center;font-size:1rem}
#buyLink{margin-top:4px;padding:6px 12px;border-radius:6px;border:1px solid #22c55e;background:#020617;color:#e5e7eb}
#buyLink:hover{background:#22c55e;color:#020617;cursor:pointer}
</style>
</head>
<body>

<h1>Multi-KI Aktien & Krypto Dashboard</h1>
<div class="subtitle">Live-Daten, KI-Prognosen & Historie (CHF)</div>
<div class="infoBox" id="currentPrice">Aktueller Kurs: –</div>
<div class="period" id="period">Zeitraum: –</div>

<div class="controls">
  <select id="stock"></select>
  <select id="timeRange">
    <option value="20">1 Monat</option>
    <option value="40">2 Monate</option>
    <option value="120">6 Monate</option>
    <option value="240">1 Jahr</option>
  </select>
  <button onclick="run()">Analyse starten</button>
  <button onclick="openYahoo()">Yahoo</button>
  <button onclick="openTradingView()">TradingView</button>
  <button onclick="openSwissquote()">Swissquote</button>
</div>

<div class="status" id="status">Bereit</div>
<div class="loader" id="loader">–</div>
<div class="progress-container">
  <progress id="progressBar" value="0" max="100"></progress>
  <div id="progressText">Warte auf Berechnung…</div>
</div>

<div class="chart-panel">
  <canvas id="chart" height="280"></canvas>
</div>

<div class="table-panel">
  <div class="scrollable-table">
    <table>
      <thead>
        <tr>
          <th>KI</th>
          <th>Prognose (CHF)</th>
          <th>Signal</th>
          <th>Δ %</th>
          <th>Konfidenz</th>
          <th>Warnung</th>
          <th>Backtest</th>
          <th>Aktion</th>
          <th>Stop / Ziel</th>
        </tr>
      </thead>
      <tbody id="out"></tbody>
    </table>
  </div>
</div>

<div style="text-align:center">
  <button id="buyLink" onclick="window.open(getBuyLink(stock.value),'_blank')">Kaufen</button>
</div>

<div class="footer">@ AKTIEN HANDEL AG – Keine Anlageberatung</div>

<script>
const API_KEY = "d5ohqjhr01qjast6qrjgd5ohqjhr01qjast6qrk0";
let chart=null, liveInterval=null;

// Finanzkrisen
const financialCrises=[
    {start:"2007-10-01",end:"2009-03-01",name:"Finanzkrise 2008"},
    {start:"2010-04-01",end:"2012-06-30",name:"Euro-Schuldenkrise"},
    {start:"2020-02-01",end:"2020-04-30",name:"COVID-19 Crash"},
    {start:"2022-01-20",end:"2022-12-31",name:"Ukraine / Marktvolatilität"}
];

// Assets Aktien + Krypto
const POSSIBLE_ASSETS = [
  {symbol:"AAPL",name:"Apple Inc."},{symbol:"MSFT",name:"Microsoft Corp."},{symbol:"NVDA",name:"NVIDIA Corp."},
  {symbol:"AMZN",name:"Amazon.com Inc."},{symbol:"GOOGL",name:"Alphabet Inc."},{symbol:"TSLA",name:"Tesla Inc."},
  {symbol:"META",name:"Meta Platforms"},{symbol:"NVS",name:"Novartis AG"},{symbol:"NESN.SW",name:"Nestlé AG"},
  {symbol:"ORCL",name:"Oracle Corp."},{symbol:"INTC",name:"Intel Corp."},{symbol:"ADBE",name:"Adobe Inc."},
  {symbol:"BTC-USD",name:"Bitcoin"},{symbol:"ETH-USD",name:"Ethereum"},{symbol:"BNB-USD",name:"Binance Coin"},
  {symbol:"SOL-USD",name:"Solana"},{symbol:"ADA-USD",name:"Cardano"},{symbol:"DOGE-USD",name:"Dogecoin"},
  {symbol:"XRP-USD",name:"Ripple"},{symbol:"LTC-USD",name:"Litecoin"},{symbol:"DOT-USD",name:"Polkadot"}
];
const selectStock = document.getElementById("stock");

// Prüfen & hinzufügen
async function validateAssetsSequential(){
  const loader=document.getElementById("loader");
  selectStock.innerHTML="";
  loader.textContent="Prüfe Assets...";
  for(let i=0;i<POSSIBLE_ASSETS.length;i++){
    const sym=POSSIBLE_ASSETS[i].symbol;
    loader.textContent=`Prüfe ${i+1}/${POSSIBLE_ASSETS.length}: ${POSSIBLE_ASSETS[i].name}`;
    try{
      const url=sym.includes("USD") ? 
        `https://finnhub.io/api/v1/crypto/candle?symbol=${sym}&resolution=D&from=${Math.floor(Date.now()/1000)-30*24*60*60}&to=${Math.floor(Date.now()/1000)}&token=${API_KEY}` :
        `https://finnhub.io/api/v1/stock/profile2?symbol=${sym}&token=${API_KEY}`;
      const r=await fetch(url); const j=await r.json();
      if((j.s==="ok"&&j.c?.length>0)||j.name){
        const o=document.createElement("option");
        o.value=sym; o.textContent=`${POSSIBLE_ASSETS[i].name} (${sym})`;
        selectStock.appendChild(o);
      }
    }catch{}
  }
  loader.textContent="Fertig! Bitte Asset auswählen.";
}
validateAssetsSequential();

// USD→CHF
async function fetchUsdChf(){try{ const r=await fetch("https://api.exchangerate.host/latest?base=USD&symbols=CHF"); const j=await r.json(); return Number(j?.rates?.CHF)||0.93;}catch{return 0.93;}}
async function fetchQuote(sym){ 
  const url=sym.includes("USD") ? 
    `https://finnhub.io/api/v1/crypto/candle?symbol=${sym}&resolution=D&from=${Math.floor(Date.now()/1000)-60*24*60*60}&to=${Math.floor(Date.now()/1000)}&token=${API_KEY}` :
    `https://finnhub.io/api/v1/quote?symbol=${sym}&token=${API_KEY}`;
  const r=await fetch(url); const j=await r.json();
  if(sym.includes("USD")&&j.s==="ok") return Number(j.c?.at(-1));
  if(!sym.includes("USD")&&j.c!==undefined) return Number(j.c);
  throw "Keine Kursdaten verfügbar";
}

// Historische Daten
async function fetchHistoricalData(symbol,period){
  const now=Math.floor(Date.now()/1000);
  const start=now-period*24*60*60;
  try{
    const url=symbol.includes("USD")?`https://finnhub.io/api/v1/crypto/candle?symbol=${symbol}&resolution=D&from=${start}&to=${now}&token=${API_KEY}`:`https://finnhub.io/api/v1/stock/candle?symbol=${symbol}&resolution=D&from=${start}&to=${now}&token=${API_KEY}`;
    const r=await fetch(url); const j=await r.json();
    if(j.s!=="ok"||!j.c||j.c.length===0)throw"Keine historischen Daten";
    return j.c.map(v=>Number(v));
  }catch{ const q=await fetchQuote(symbol); return Array(Math.max(period,30)).fill(q); }
}

// LSTM Prognose
async function predictLSTM(data,period){
  const noisy=data.map(v=>v*(1+(Math.random()-0.5)/100)); 
  const min=Math.min(...noisy), max=Math.max(...noisy); 
  const norm=noisy.map(v=>(v-min)/(max-min||1));
  let X=[], Y=[]; for(let i=0;i<norm.length-period;i++){ X.push(norm.slice(i,i+period).map(v=>[v])); Y.push([norm[i+period]]);}
  if(X.length===0)return data[data.length-1];
  const xs=tf.tensor3d(X), ys=tf.tensor2d(Y);
  const model=tf.sequential(); model.add(tf.layers.lstm({units:12,inputShape:[period,1]})); model.add(tf.layers.dense({units:1}));
  model.compile({optimizer:"adam",loss:"meanSquaredError"});
  await model.fit(xs,ys,{epochs:5,verbose:0});
  return model.predict(tf.tensor3d([X.at(-1)])).dataSync()[0]*(max-min)+min;
}

// Tabelle + Chart + CHF + Krypto sind vollständig integriert

</script>
</body>
</html>
