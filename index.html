<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>KI Aktien Analyse â€“ Lokal</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{background:#0f172a;color:#e5e7eb;font-family:Arial;padding:20px}
h1{text-align:center}
select,button{
  padding:10px;margin:6px;
  background:#020617;color:#fff;
  border:1px solid #22c55e;border-radius:6px
}
button:hover{background:#22c55e;color:#000;cursor:pointer}
#loader{text-align:center;color:#38bdf8;margin-top:10px}
.card{background:#020617;padding:14px;border-radius:8px;margin-top:12px}
canvas{margin-top:20px}
</style>
</head>

<body>

<h1>ğŸ§  KI Aktien Analyse (lokale Liste)</h1>
<p style="text-align:center">Nur gespeicherte Aktien â€¢ echte Historie â€¢ Quant-Logik</p>

<div style="text-align:center">
  <select id="stock"></select><br>
  <button onclick="loadStocks()">ğŸ”„ Neu prÃ¼fen</button>
  <button onclick="runAnalysis()">ğŸ“Š Analyse</button>
</div>

<div id="loader">â€“</div>
<div id="result" class="card" style="display:none"></div>
<canvas id="chart" height="260"></canvas>

<script>
/* ================= API ================= */
const API_KEY = "d5ohqjhr01qjast6qrjgd5ohqjhr01qjast6qrk0";

/* ================= FESTE AKTIEN ================= */
const STOCKS = [
 {symbol:"AAPL",name:"Apple"},
 {symbol:"MSFT",name:"Microsoft"},
 {symbol:"GOOGL",name:"Alphabet"},
 {symbol:"AMZN",name:"Amazon"},
 {symbol:"META",name:"Meta"},
 {symbol:"NVDA",name:"NVIDIA"},
 {symbol:"TSLA",name:"Tesla"},
 {symbol:"JPM",name:"JPMorgan"},
 {symbol:"V",name:"Visa"},
 {symbol:"MA",name:"Mastercard"},
 {symbol:"KO",name:"Coca-Cola"},
 {symbol:"PEP",name:"Pepsi"},
 {symbol:"WMT",name:"Walmart"},
 {symbol:"DIS",name:"Disney"},
 {symbol:"INTC",name:"Intel"},
 {symbol:"ORCL",name:"Oracle"},
 {symbol:"CSCO",name:"Cisco"},
 {symbol:"IBM",name:"IBM"},
 {symbol:"ADBE",name:"Adobe"},
 {symbol:"NFLX",name:"Netflix"}
];

/* ================= DOM ================= */
const selectStock=document.getElementById("stock");
const loader=document.getElementById("loader");
const resultBox=document.getElementById("result");
let chart=null;

/* ================= HISTORIE ================= */
async function fetchHistory(symbol){
  const now=Math.floor(Date.now()/1000);
  const from=now-160*86400;
  const r=await fetch(`https://finnhub.io/api/v1/stock/candle?symbol=${symbol}&resolution=D&from=${from}&to=${now}&token=${API_KEY}`);
  const j=await r.json();
  if(j.s==="ok" && j.c.length>=100) return j.c;
  throw "Keine Daten";
}

/* ================= AKTIEN LADEN ================= */
async function loadStocks(){
  selectStock.innerHTML="<option>PrÃ¼fe Aktienâ€¦</option>";
  loader.textContent="ğŸ” PrÃ¼fe lokale Aktienlisteâ€¦";
  selectStock.innerHTML="<option value=''>Aktie wÃ¤hlen</option>";

  let found=0;
  for(const s of STOCKS){
    loader.textContent=`PrÃ¼fe ${s.symbol}â€¦`;
    try{
      await fetchHistory(s.symbol);
      const o=document.createElement("option");
      o.value=s.symbol;
      o.textContent=`${s.name} (${s.symbol})`;
      selectStock.appendChild(o);
      found++;
    }catch{}
  }
  loader.textContent=`âœ… ${found} Aktien verfÃ¼gbar`;
}

/* ================= KI-CHECK ================= */
function aiCheck(prices){
  const mean=a=>a.reduce((x,y)=>x+y)/a.length;
  const std=a=>Math.sqrt(mean(a.map(x=>(x-mean(a))**2)));
  const EMA=(a,p)=>{let k=2/(p+1),e=a[0];for(let i=1;i<a.length;i++)e=a[i]*k+e*(1-k);return e};

  const last=prices.at(-1);
  const perf30=(last-prices.at(-30))/prices.at(-30)*100;
  const perf90=(last-prices.at(-90))/prices.at(-90)*100;
  const vol=std(prices.slice(-30));
  const ema20=EMA(prices.slice(-60),20);
  const ema50=EMA(prices.slice(-60),50);

  let score=50;
  if(ema20>ema50) score+=15;
  if(last>ema20) score+=10;
  if(perf30>0) score+=10;
  if(perf90>5) score+=10;
  if(vol<mean(prices)*0.03) score+=10;
  if(vol>mean(prices)*0.07) score-=15;

  score=Math.max(0,Math.min(100,score));
  const verdict=score>=80?"ğŸŸ¢ Investierbar":score>=60?"ğŸŸ¡ Beobachten":score>=40?"ğŸŸ  Schwach":"ğŸ”´ Meiden";
  return{score,verdict,perf30,perf90,vol};
}

/* ================= ANALYSE ================= */
async function runAnalysis(){
  const sym=selectStock.value;
  if(!sym) return alert("Aktie wÃ¤hlen");

  loader.textContent="ğŸ“Š Analyse lÃ¤uftâ€¦";
  resultBox.style.display="none";

  const prices=await fetchHistory(sym);
  const ai=aiCheck(prices);

  resultBox.innerHTML=`
    <b>${sym}</b><br>
    KI-Score: ${ai.score}/100<br>
    Status: ${ai.verdict}<br><br>
    30T: ${ai.perf30.toFixed(2)}%<br>
    90T: ${ai.perf90.toFixed(2)}%<br>
    Risiko: ${ai.vol.toFixed(2)}
  `;
  resultBox.style.display="block";
  drawChart(prices);
  loader.textContent="âœ… Fertig";
}

/* ================= CHART ================= */
function drawChart(data){
  if(chart) chart.destroy();
  chart=new Chart(document.getElementById("chart"),{
    type:"line",
    data:{labels:data.map((_,i)=>i),datasets:[{label:"Kurs",data,borderColor:"#38bdf8",fill:false}]},
    options:{responsive:true}
  });
}

/* ================= START ================= */
loadStocks();
</script>

</body>
</html>
