<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Asset Analyse Pro</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
 font-family:Arial, sans-serif;
 background:#020617;
 color:#e5e7eb;
 padding:20px;
}
#app{
 max-width:900px;
 margin:auto;
 background:#020617;
}
.card{
 background:#020617;
 border:1px solid #1e293b;
 padding:15px;
 border-radius:10px;
 margin-bottom:15px;
}
select,button{
 padding:10px;
 width:100%;
 margin-top:5px;
 background:#020617;
 color:white;
 border:1px solid #1e293b;
 border-radius:6px;
}
.progress{height:8px;background:#1e293b;border-radius:4px;overflow:hidden}
.progress div{height:100%;width:0%;background:#38bdf8}
.small{font-size:12px;opacity:.8}
.warn{color:#facc15}
.good{color:#22c55e}
.bad{color:#ef4444}
</style>
</head>

<body>
<div id="app">

<div class="card">
<h2>ğŸ” Asset-Scanner</h2>
<div id="status">Starte Sucheâ€¦</div>
<div class="progress"><div id="bar"></div></div>
<div class="small" id="counter"></div>
<div class="small" id="eta"></div>

<select id="assetSelect"></select>
<button onclick="loadAsset()">ğŸ“Š Analysieren</button>
</div>

<div class="card">
<h2>ğŸ“ˆ Analyse</h2>
<div id="price">â€“</div>
<div id="trend">â€“</div>
<div id="warning">â€“</div>
<canvas id="chart" height="120"></canvas>

<button onclick="openTV()">TradingView</button>
<button onclick="openBuy()">Kaufen</button>
</div>

</div>
<script>
/* ================= CONFIG ================= */
const FINNHUB_KEY="d5ohqjhr01qjast6qrjgd5ohqjhr01qjast6qrk0";
const TARGET=10;
const DELAY=1200;
const PERIODS=[365,200,10];

/* ================= STATE ================= */
let checked=0,found=[],start=Date.now();
let chart;

/* ================= ASSETS ================= */
const STOCKS=[
 {s:"AAPL",n:"Apple Inc."},{s:"MSFT",n:"Microsoft Corporation"},
 {s:"AMZN",n:"Amazon.com Inc."},{s:"NVDA",n:"NVIDIA Corporation"},
 {s:"META",n:"Meta Platforms Inc."},{s:"TSLA",n:"Tesla Inc."}
];
const CRYPTO=[
 {s:"BTCUSDT",n:"Bitcoin"},{s:"ETHUSDT",n:"Ethereum"},
 {s:"BNBUSDT",n:"BNB"},{s:"SOLUSDT",n:"Solana"}
];

const ALL=[...STOCKS.map(x=>({...x,t:"stock"})),
           ...CRYPTO.map(x=>({...x,t:"crypto"}))];

/* ================= UI ================= */
const sel=document.getElementById("assetSelect");
function ui(){
 document.getElementById("counter").textContent=
  `GeprÃ¼ft: ${checked} | Gefunden: ${found.length}`;
 document.getElementById("bar").style.width=
  Math.min(100,(found.length/TARGET)*100)+"%";
 let avg=((Date.now()-start)/1000)/(checked||1);
 document.getElementById("eta").textContent=
  `ETA: ${Math.ceil((TARGET-found.length)*avg)}s`;
}

/* ================= DATA ================= */
async function stockHist(sym,days){
 const to=Math.floor(Date.now()/1000);
 const from=to-days*86400;
 const r=await fetch(
  `https://finnhub.io/api/v1/stock/candle?symbol=${sym}&resolution=D&from=${from}&to=${to}&token=${FINNHUB_KEY}`);
 const d=await r.json();
 return d.s==="ok"?d.c:null;
}

async function cryptoHist(sym,days){
 const r=await fetch(
  `https://api.binance.com/api/v3/klines?symbol=${sym}&interval=1d&limit=${days}`);
 const d=await r.json();
 return Array.isArray(d)?d.map(x=>+x[4]):null;
}

/* ================= SCAN ================= */
async function scan(){
 sel.innerHTML="";
 for(const a of ALL){
  if(found.length>=TARGET)break;
  checked++;
  for(const p of PERIODS){
   try{
    const data=a.t==="stock"
     ?await stockHist(a.s,p)
     :await cryptoHist(a.s,p);
    if(data&&data.length>=10){
     found.push({...a,p});
     let o=document.createElement("option");
     o.value=a.s;o.textContent=`${a.n} (${a.t})`;
     sel.appendChild(o);
     break;
    }
   }catch{}
  }
  ui();
  await new Promise(r=>setTimeout(r,DELAY));
 }
 document.getElementById("status").textContent="âœ… Suche abgeschlossen";
}

/* ================= ANALYSE ================= */
async function loadAsset(){
 const sym=sel.value;
 const a=found.find(x=>x.s===sym);
 const data=a.t==="stock"
  ?await stockHist(sym,a.p)
  :await cryptoHist(sym,a.p);

 const last=data[data.length-1];
 document.getElementById("price").textContent=
  `Aktueller Kurs: ${last.toFixed(2)}`;

 const ma=data.slice(-20).reduce((a,b)=>a+b,0)/20;
 document.getElementById("trend").textContent=
  last>ma?"Trend: steigend":"Trend: fallend";

 const drop=(Math.max(...data)-last)/Math.max(...data);
 document.getElementById("warning").innerHTML=
  drop>0.25?'<span class="warn">âš ï¸ Hoher Drawdown</span>':
  '<span class="good">Keine Warnung</span>';

 if(chart)chart.destroy();
 chart=new Chart(document.getElementById("chart"),{
  type:"line",
  data:{labels:data.map((_,i)=>i),
  datasets:[{data,borderWidth:2}]},
  options:{plugins:{legend:{display:false}}}
 });
}

/* ================= LINKS ================= */
function openTV(){
 const a=found.find(x=>x.s===sel.value);
 const sym=a.t==="crypto"?"BINANCE:"+a.s:"NASDAQ:"+a.s;
 window.open(`https://www.tradingview.com/chart/?symbol=${sym}`,"_blank");
}
function openBuy(){
 const a=found.find(x=>x.s===sel.value);
 window.open(
  a.t==="crypto"
  ?`https://www.binance.com/en/trade/${a.s}`
  :`https://www.nasdaq.com/market-activity/stocks/${a.s.toLowerCase()}`,
  "_blank");
}

scan();
</script>
</body>
</html>
