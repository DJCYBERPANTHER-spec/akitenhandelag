<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multi-KI Aktienanalyse ‚Äì 130 Aktien</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{background:#0f172a;color:#e5e7eb;font-family:Arial;padding:15px}
h1{text-align:center}
.subtitle{text-align:center;color:#94a3b8;font-size:0.9rem}
.controls{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin:12px 0}
select,button{background:#020617;color:#e5e7eb;border:1px solid #22c55e;padding:8px 12px;border-radius:6px}
button:hover{background:#22c55e;color:#020617;cursor:pointer}
canvas{background:#020617;border-radius:10px;margin-top:15px}
table{width:100%;border-collapse:collapse;margin-top:15px;font-size:0.85rem}
th,td{border:1px solid #22c55e;padding:6px;text-align:center}
.buy{color:#22c55e;font-weight:bold}
.sell{color:#ef4444;font-weight:bold}
.hold{color:#facc15;font-weight:bold}
.warning{color:#f87171;font-weight:bold}
.conf{color:#38bdf8;font-weight:bold}
.footer{text-align:center;font-size:0.75rem;color:#94a3b8;margin-top:12px}
progress{width:80%;height:16px}
.bestKI{background-color:#22c55e33;}
#currentPrice{margin:8px 0;font-weight:bold;text-align:center;font-size:1rem}
#buyLink{margin-top:4px;padding:6px 12px;border-radius:6px;border:1px solid #22c55e;background:#020617;color:#e5e7eb}
#buyLink:hover{background:#22c55e;color:#020617;cursor:pointer}
</style>
</head>

<body>

<h1>Multi-KI Aktienanalyse ‚Äì 130 Aktien</h1>
<div class="subtitle">365 Tage Historie ¬∑ Prognosen auf ausgew√§hlte Aktie ¬∑ Fr√ºhwarnsystem</div>

<div class="controls">
<select id="stock"></select>

<select id="forecastRange">
<option value="1">24h</option>
<option value="5">1 Woche</option>
<option value="22">1 Monat</option>
<option value="66">3 Monate</option>
<option value="132">6 Monate</option>
<option value="264">1 Jahr</option>
<option value="1320">5 Jahre</option>
</select>

<button onclick="run()">Analyse starten</button>
</div>

<div id="status">Bereit</div>
<div id="currentPrice"></div>
<div style="text-align:center">
<button id="buyLink" onclick="window.open(getBuyLink(stock.value),'_blank')">Aktie kaufen</button>
</div>

<div style="text-align:center">
<progress id="progressBar" value="0" max="100"></progress>
<div id="progressText"></div>
</div>

<canvas id="chart" height="260"></canvas>

<table>
<thead>
<tr>
<th>KI</th>
<th>Prognose</th>
<th>Signal</th>
<th>Œî %</th>
<th>Konfidenz</th>
<th>Warnung</th>
<th>Backtest</th>
<th>Aktion</th>
<th>Stop / Ziel</th>
</tr>
</thead>
<tbody id="out"></tbody>
</table>

<div class="footer">‚ö†Ô∏è Analyse-Tool ‚Äì keine Anlageberatung</div>

<script>
const API_KEY = "d5ohqjhr01qjast6qrjgd5ohqjhr01q";
let chart = null;
let priceInterval = null;

/* =======================
   FESTE 130 AKTIEN
======================= */
const sel = document.getElementById("stock");
const STOCKS = [
  {symbol:"AAPL", name:"Apple"}, {symbol:"MSFT", name:"Microsoft"}, {symbol:"AMZN", name:"Amazon"},
  {symbol:"TSLA", name:"Tesla"}, {symbol:"GOOGL", name:"Alphabet"}, {symbol:"GOOG", name:"Alphabet Class C"},
  {symbol:"META", name:"Meta Platforms"}, {symbol:"BRK.B", name:"Berkshire Hathaway"}, {symbol:"NVDA", name:"NVIDIA"},
  {symbol:"UNH", name:"UnitedHealth"}, {symbol:"V", name:"Visa"}, {symbol:"PG", name:"Procter & Gamble"},
  {symbol:"LLY", name:"Eli Lilly"}, {symbol:"MA", name:"Mastercard"}, {symbol:"HD", name:"Home Depot"},
  {symbol:"BAC", name:"Bank of America"}, {symbol:"XOM", name:"Exxon Mobil"}, {symbol:"JPM", name:"JP Morgan"},
  {symbol:"KO", name:"Coca-Cola"}, {symbol:"DIS", name:"Disney"}, {symbol:"ADBE", name:"Adobe"},
  {symbol:"NFLX", name:"Netflix"}, {symbol:"CMCSA", name:"Comcast"}, {symbol:"PFE", name:"Pfizer"},
  {symbol:"PEP", name:"PepsiCo"}, {symbol:"ABBV", name:"AbbVie"}, {symbol:"INTC", name:"Intel"},
  {symbol:"CSCO", name:"Cisco"}, {symbol:"T", name:"AT&T"}, {symbol:"WMT", name:"Walmart"},
  {symbol:"CRM", name:"Salesforce"}, {symbol:"ABT", name:"Abbott"}, {symbol:"ACN", name:"Accenture"},
  {symbol:"AVGO", name:"Broadcom"}, {symbol:"COST", name:"Costco"}, {symbol:"CVX", name:"Chevron"},
  {symbol:"NKE", name:"Nike"}, {symbol:"ORCL", name:"Oracle"}, {symbol:"TXN", name:"Texas Instruments"},
  {symbol:"MCD", name:"McDonald's"}, {symbol:"QCOM", name:"Qualcomm"}, {symbol:"NEE", name:"NextEra Energy"},
  {symbol:"DHR", name:"Danaher"}, {symbol:"MDT", name:"Medtronic"}, {symbol:"BMY", name:"Bristol-Myers Squibb"},
  {symbol:"LOW", name:"Lowe's"}, {symbol:"AMGN", name:"Amgen"}, {symbol:"HON", name:"Honeywell"},
  {symbol:"SBUX", name:"Starbucks"}, {symbol:"LIN", name:"Linde"}, {symbol:"UNP", name:"Union Pacific"},
  {symbol:"AMAT", name:"Applied Materials"}, {symbol:"RTX", name:"Raytheon"}, {symbol:"MMM", name:"3M"},
  {symbol:"GE", name:"General Electric"}, {symbol:"AXP", name:"American Express"}, {symbol:"UPS", name:"UPS"},
  {symbol:"PLD", name:"Prologis"}, {symbol:"BKNG", name:"Booking Holdings"}, {symbol:"SPGI", name:"S&P Global"},
  {symbol:"SCHW", name:"Charles Schwab"}, {symbol:"BLK", name:"BlackRock"}, {symbol:"TMO", name:"Thermo Fisher"},
  {symbol:"GILD", name:"Gilead"}, {symbol:"ANTM", name:"Anthem"}, {symbol:"MS", name:"Morgan Stanley"},
  {symbol:"DUK", name:"Duke Energy"}, {symbol:"PYPL", name:"PayPal"}, {symbol:"ISRG", name:"Intuitive Surgical"},
  {symbol:"ADP", name:"ADP"}, {symbol:"BDX", name:"Becton Dickinson"}, {symbol:"CVS", name:"CVS Health"},
  {symbol:"ZTS", name:"Zoetis"}, {symbol:"MO", name:"Altria"}, {symbol:"LMT", name:"Lockheed Martin"},
  {symbol:"CCI", name:"Crown Castle"}, {symbol:"EL", name:"Est√©e Lauder"}, {symbol:"COP", name:"ConocoPhillips"},
  {symbol:"SYK", name:"Stryker"}, {symbol:"C", name:"Citigroup"}, {symbol:"PNC", name:"PNC Financial"},
  {symbol:"TMUS", name:"T-Mobile"}, {symbol:"GS", name:"Goldman Sachs"}, {symbol:"USB", name:"US Bank"},
  {symbol:"TGT", name:"Target"}, {symbol:"CHTR", name:"Charter Communications"}, {symbol:"SO", name:"Southern Co."},
  {symbol:"CI", name:"Cigna"}, {symbol:"CB", name:"Chubb"}, {symbol:"AON", name:"Aon"}, {symbol:"MMC", name:"Marsh McLennan"},
  {symbol:"DE", name:"Deere & Co."}, {symbol:"ES", name:"Eversource"}, {symbol:"EMR", name:"Emerson Electric"},
  {symbol:"ATVI", name:"Activision"}, {symbol:"EW", name:"Edwards Lifesciences"}, {symbol:"KMB", name:"Kimberly-Clark"},
  {symbol:"SLB", name:"Schlumberger"}, {symbol:"ETN", name:"Eaton"}, {symbol:"HUM", name:"Humana"}, {symbol:"GM", name:"General Motors"},
  {symbol:"F", name:"Ford"}, {symbol:"FDX", name:"FedEx"}, {symbol:"ICE", name:"Intercontinental Exchange"}, {symbol:"PNW", name:"Pinnacle West"},
  {symbol:"ADSK", name:"Autodesk"}, {symbol:"DLR", name:"Digital Realty"}, {symbol:"APD", name:"Air Products"}, {symbol:"ZBH", name:"Zimmer Biomet"},
  {symbol:"ETR", name:"Entergy"}, {symbol:"HCA", name:"HCA Healthcare"}, {symbol:"CL", name:"Colgate-Palmolive"}, {symbol:"MAR", name:"Marriott"},
  {symbol:"PGR", name:"Progressive"}, {symbol:"ALL", name:"Allstate"}, {symbol:"STZ", name:"Constellation Brands"},
  {symbol:"AIG", name:"AIG"}, {symbol:"LRCX", name:"Lam Research"}, {symbol:"MSI", name:"Motorola Solutions"},
  {symbol:"REGN", name:"Regeneron"}, {symbol:"ROP", name:"Roper Technologies"}, {symbol:"AEP", name:"American Electric Power"},
  {symbol:"MCO", name:"Moody's"}, {symbol:"MHK", name:"Mohawk Industries"}, {symbol:"SHW", name:"Sherwin-Williams"},
  {symbol:"ILMN", name:"Illumina"}, {symbol:"VRTX", name:"Vertex Pharmaceuticals"}, {symbol:"KHC", name:"Kraft Heinz"},
  {symbol:"KR", name:"Kroger"}, {symbol:"HSY", name:"Hershey"}, {symbol:"PNR", name:"Pentair"}, {symbol:"WBA", name:"Walgreens"},
  {symbol:"CTAS", name:"Cintas"}, {symbol:"ECL", name:"Ecolab"}, {symbol:"FIS", name:"Fidelity National Information Services"},
  {symbol:"IQV", name:"IQVIA"}, {symbol:"SRE", name:"Sempra Energy"}, {symbol:"WMB", name:"Williams Companies"}, {symbol:"OXY", name:"Occidental Petroleum"},
  {symbol:"AMLX", name:"AmerisourceBergen"}
];

// Optionen ins Select einf√ºgen
STOCKS.forEach(s => {
    const o = document.createElement("option");
    o.value = s.symbol;
    o.textContent = `${s.name} (${s.symbol})`;
    sel.appendChild(o);
});
sel.selectedIndex = 0;

/* =======================
   HILFSFUNKTIONEN
======================= */
function updateProgress(p,text){document.getElementById("progressBar").value=p;document.getElementById("progressText").textContent=text;}
function sleep(ms){return new Promise(r=>setTimeout(r,ms));}
function getBuyLink(sym){return `https://www.tradingview.com/symbols/${sym}/`;}
</script>
<script>
/* =======================
   FINANZKRISEN & FR√úHWARNUNGEN
======================= */
const financialCrises = [
    {start: "2007-10-01", end: "2009-03-01", name: "Finanzkrise 2008"},
    {start: "2010-04-01", end: "2012-06-30", name: "Euro-Schuldenkrise"},
    {start: "2020-02-01", end: "2020-04-30", name: "COVID-19 Crash"},
    {start: "2022-01-20", end: "2022-12-31", name: "Ukraine / Marktvolatilit√§t"}
];

const crisisConditions = [
    {name:"Finanzkrise 2008", maxVol:0.07, minTrend:-0.1, maxDailyDrop:-0.05},
    {name:"Euro-Schuldenkrise", maxVol:0.06, minTrend:-0.08, maxDailyDrop:-0.04},
    {name:"COVID-19 Crash", maxVol:0.08, minTrend:-0.12, maxDailyDrop:-0.07},
    {name:"Ukraine / Marktvolatilit√§t 2022", maxVol:0.06, minTrend:-0.08, maxDailyDrop:-0.05}
];

/* =======================
   HISTORIE + AKTUELLER KURS
======================= */
async function fetchHist(sym, days=365){
    const now = Math.floor(Date.now()/1000);
    const from = now - days*86400;
    try{
        const res = await fetch(`https://finnhub.io/api/v1/stock/candle?symbol=${sym}&resolution=D&from=${from}&to=${now}&token=${API_KEY}`);
        const data = await res.json();
        if(data.s==="ok" && data.c && data.c.length>=60){
            const dates = data.t.map(ts=>new Date(ts*1000).toISOString().split("T")[0]);
            const closes = data.c.map(v=>Number(v));
            return {dates, closes};
        }
    }catch(e){}
    // Fallback: kleine Simulation
    const arr=[], dates=[];
    let base = 400;
    for(let i=0;i<days;i++){
        base *= 1+0.002*Math.sin(i/5);
        arr.push(base);
        const d = new Date(); d.setDate(d.getDate()-days+i);
        dates.push(d.toISOString().split("T")[0]);
    }
    return {dates, closes:arr};
}

async function fetchPrice(sym){
    try{
        const r = await fetch(`https://finnhub.io/api/v1/quote?symbol=${sym}&token=${API_KEY}`);
        const j = await r.json();
        if(j && j.c) return j.c;
    }catch{}
    return null;
}

/* =======================
   ANALYSE / TREND / VOLATILIT√ÑT
======================= */
function trend(h){const s=h.slice(-20).reduce((a,b)=>a+b,0)/20;const l=h.slice(-100).reduce((a,b)=>a+b,0)/100;return (s-l)/l;}
function volatility(h){const avg=h.reduce((a,b)=>a+b,0)/h.length;return Math.sqrt(h.reduce((a,b)=>a+Math.pow(b-avg,2),0)/h.length)/avg;}
function backtest(h){let e=0;const n=Math.min(60,h.length-1);for(let i=h.length-n;i<h.length-1;i++){const p=h[i]*(1+trend(h.slice(0,i)));e+=Math.min(Math.abs((p-h[i+1])/h[i+1]),1);}return Math.max(0,((1-e/n)*100)).toFixed(1)+"%";}
function calcConfidence(hist){let conf=0.5+0.3*(parseFloat(backtest(hist))/100)+0.2*(1-volatility(hist));return conf>1?1:conf;}

/* =======================
   WARNUNGEN
======================= */
function calcWarningForecast(dates,h,future=null){
    const vol=volatility(h);
    const tr=trend(h);
    const last=future!==null?future:h[h.length-1];
    const prev=h[h.length-2]||last;
    const delta=(last-prev)/prev;

    if(vol>0.06) return "‚ö†Ô∏è Hohe Volatilit√§t";
    if(delta<-0.05) return "‚ö†Ô∏è Starker Kursabfall";
    if(delta>0.05) return "‚ö†Ô∏è Starker Anstieg";
    if(tr<-0.15) return "‚ö†Ô∏è Abw√§rtstrend";
    if(tr>0.15) return "‚ö†Ô∏è Aufw√§rtstrend";

    for(let c of crisisConditions){
        if(vol>=c.maxVol*0.7 && tr<=c.minTrend*0.7 && delta<=c.maxDailyDrop*0.7){
            return `‚ö†Ô∏è Fr√ºhwarnung: Bedingungen √§hnlich ${c.name}`;
        }
    }

    const lastDate=dates[dates.length-1];
    for(let crisis of financialCrises){
        const start=new Date(crisis.start);
        const end=new Date(crisis.end);
        const d=new Date(lastDate);
        if(d>=start && d<=end) return `‚ö†Ô∏è Finanzkrise: ${crisis.name}`;
    }

    return "";
}

/* =======================
   ENTSCHEIDUNG / RISK
======================= */
function decision(curr,fut,h){
    const t=trend(h),v=volatility(h),bt=parseFloat(backtest(h))/100;
    if(v>0.06||bt<0.5) return ["üü° WARTEN","Volatilit√§t oder schlechte Historie"];
    if(fut>curr*1.03 && t>0) return ["üü¢ KAUFEN","Aufw√§rtstrend best√§tigt"];
    if(fut<curr*0.97 && t<0) return ["üî¥ VERKAUFEN","Abw√§rtstrend best√§tigt"];
    return ["‚ö™ HALTEN","Keine klare Richtung"];
}
function risk(curr,h){const v=volatility(h)*curr;return {sl:(curr-2*v).toFixed(2),tp:(curr+3*v).toFixed(2)};}

/* =======================
   FORECAST
======================= */
function forecast(hist,days,idx,currentPrice){
    let price=currentPrice;
    const t=trend(hist),vol=volatility(hist),decay=0.95;
    const histMax=Math.max(...hist),histMin=Math.min(...hist);
    const result=[];
    for(let i=0;i<days;i++){
        const factor=t*(1+idx*0.05)*Math.pow(decay,i/30);
        const randEffect=(Math.random()-0.5)*vol*0.5;
        price*=(1+factor+randEffect);
        price=Math.max(histMin*0.8,Math.min(histMax*1.2,price));
        result.push(price);
    }
    return result;
}

/* =======================
   CHART
======================= */
function draw(hist,futs){
    if(chart) chart.destroy();
    const labels=[];
    for(let i=hist.length;i>0;i--) labels.push("-"+i+"d");
    for(let i=1;i<=futs[0].length;i++) labels.push("+"+i+"d");
    const datasets=[{label:"Historie (365 Tage)",data:hist,borderColor:"#3b82f6",fill:false}];
    const colors=["#22c55e","#facc15","#f97316","#38bdf8"];
    futs.forEach((f,i)=>datasets.push({label:"KI "+(i+1),data:[...Array(hist.length).fill(null),...f],borderColor:colors[i],fill:false,pointRadius:2}));
    chart=new Chart(document.getElementById("chart"),{type:"line",data:{labels,datasets},options:{animation:false,responsive:true}});
}

/* =======================
   BESTE KI
======================= */
function markBestKI(){
    const rows=document.querySelectorAll("#out tr");
    if(rows.length===0) return;
    let bestValue=-Infinity,bestRow=null;
    rows.forEach(row=>{const val=parseFloat(row.cells[1].textContent);if(val>bestValue){bestValue=val;bestRow=row;}row.classList.remove("bestKI");});
    if(bestRow) bestRow.classList.add("bestKI");
}

/* =======================
   AKTUELLER KURS
======================= */
function startPriceInterval(){
    if(priceInterval) clearInterval(priceInterval);
    updateCurrentPrice(sel.value);
    priceInterval=setInterval(()=>updateCurrentPrice(sel.value),5000);
}
async function updateCurrentPrice(sym){
    const price=await fetchPrice(sym);
    if(price) document.getElementById("currentPrice").textContent=`Aktueller Kurs ${sym}: ${price.toFixed(2)} USD`;
}

/* =======================
   RUN
======================= */
async function run(){
    try{
        updateProgress(0,"Starte Analyse‚Ä¶");
        document.getElementById("status").textContent="Analyse l√§uft‚Ä¶";

        const sym=sel.value;
        const days=+document.getElementById("forecastRange").value;

        updateProgress(10,"Lade historische Daten‚Ä¶");
        const histObj=await fetchHist(sym);
        await sleep(150);

        updateProgress(25,"Lade aktuellen Kurs‚Ä¶");
        const price=await fetchPrice(sym)||histObj.closes[histObj.closes.length-1];
        await sleep(100);

        const futs=[];
        for(let i=0;i<4;i++){
            updateProgress(35+i*15,`KI ${i+1} berechnet Prognose‚Ä¶`);
            const f=forecast(histObj.closes,days,i,price);
            futs.push(f);
            await sleep(100);
        }

        updateProgress(85,"Erstelle Diagramm‚Ä¶");
        draw(histObj.closes,futs);

        updateProgress(92,"Erstelle Tabelle‚Ä¶");
        let html="";
        futs.forEach((f,i)=>{
            const last=f[f.length-1];
            const dec=decision(price,last,histObj.closes);
            const r=risk(price,histObj.closes);
            const conf=(calcConfidence(histObj.closes)*100).toFixed(0);
            const warn=calcWarningForecast(histObj.dates,histObj.closes,last);

            html+=`<tr>
                <td>KI${i+1}</td>
                <td>${last.toFixed(2)}</td>
                <td class="${last>price?'buy':'sell'}">${last>price?'‚Üë':'‚Üì'}</td>
                <td>${((last-price)/price*100).toFixed(2)}%</td>
                <td class="conf">${conf}%</td>
                <td class="warning">${warn}</td>
                <td>${backtest(histObj.closes)}</td>
                <td><b>${dec[0]}</b><br>${dec[1]}</td>
                <td>üõë ${r.sl}<br>üéØ ${r.tp}</td>
            </tr>`;
        });
        document.getElementById("out").innerHTML=html;
        markBestKI();
        startPriceInterval();

        updateProgress(100,"Analyse abgeschlossen ‚úî");
        document.getElementById("status").textContent="Fertig";

    }catch(err){
        console.error(err);
        updateProgress(0,"Fehler");
        document.getElementById("status").textContent="Fehler: "+err;
    }
}
</script>
</body>
</html>
