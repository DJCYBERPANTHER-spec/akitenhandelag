<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multi-KI Aktienanalyse ‚Äì Pro</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>

<style>
body{background:#0f172a;color:#e5e7eb;font-family:Arial;padding:15px}
h1{text-align:center}
.subtitle{text-align:center;color:#94a3b8;font-size:0.9rem}
.controls{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin:12px 0}
select,button{background:#020617;color:#e5e7eb;border:1px solid #22c55e;padding:8px 12px;border-radius:6px}
button:hover{background:#22c55e;color:#020617}
canvas{background:#020617;border-radius:10px;margin-top:15px}
table{width:100%;border-collapse:collapse;margin-top:15px;font-size:0.85rem}
th,td{border:1px solid #22c55e;padding:6px;text-align:center}
.buy{color:#22c55e;font-weight:bold}
.sell{color:#ef4444;font-weight:bold}
.hold{color:#facc15;font-weight:bold}
.warning{color:#f87171;font-weight:bold}
.conf{color:#38bdf8;font-weight:bold}
.footer{text-align:center;font-size:0.75rem;color:#94a3b8;margin-top:12px}
progress{width:80%;height:16px}
</style>
</head>

<body>

<h1>Multi-KI Aktienanalyse</h1>
<div class="subtitle">Echte Daten ¬∑ Prognosen ¬∑ Kauf-/Verkaufssignale</div>

<div class="controls">
<select id="stock"></select>
<select id="forecastRange">
<option value="1">24h</option>
<option value="5">1 Woche</option>
<option value="22">1 Monat</option>
<option value="66">3 Monate</option>
<option value="132">6 Monate</option>
<option value="264">1 Jahr</option>
<option value="1320">5 Jahre</option>
</select>
<button onclick="run()">Analyse starten</button>
</div>

<div id="status">Bereit</div>
<div style="text-align:center">
<progress id="progressBar" value="0" max="100"></progress>
<div id="progressText"></div>
</div>

<canvas id="chart" height="260"></canvas>

<table>
<thead>
<tr>
<th>KI</th>
<th>Prognose</th>
<th>Signal</th>
<th>Œî %</th>
<th>Konfidenz</th>
<th>Warnung</th>
<th>Backtest</th>
<th>Aktion jetzt</th>
<th>Stop / Ziel</th>
</tr>
</thead>
<tbody id="out"></tbody>
</table>

<div class="footer">‚ö†Ô∏è Analyse-Tool ‚Äì keine Anlageberatung</div>

<script>
const API_KEY="d5ohqjhr01qjast6qrjgd5ohqjhr01qjast6qrk0";
let chart=null;

const STOCKS=[
{symbol:"AAPL",name:"Apple"},
{symbol:"MSFT",name:"Microsoft"},
{symbol:"NVDA",name:"NVIDIA"},
{symbol:"AMZN",name:"Amazon"},
{symbol:"GOOGL",name:"Alphabet"},
{symbol:"TSLA",name:"Tesla"},
{symbol:"META",name:"Meta"}
];

const sel=document.getElementById("stock");
STOCKS.forEach(s=>{
let o=document.createElement("option");
o.value=s.symbol;
o.textContent=s.name+" ("+s.symbol+")";
sel.appendChild(o);
});
</script>
<script>
// ---------------- DATEN ----------------
async function fetchHist(sym,days=365){
const now=Math.floor(Date.now()/1000);
const from=now-days*86400;
const r=await fetch(`https://finnhub.io/api/v1/stock/candle?symbol=${sym}&resolution=D&from=${from}&to=${now}&token=${API_KEY}`);
const j=await r.json();
if(j.s!=="ok") throw "Keine historischen Daten";
return j.c.map(Number);
}

async function fetchPrice(sym){
const r=await fetch(`https://finnhub.io/api/v1/quote?symbol=${sym}&token=${API_KEY}`);
const j=await r.json();
return j.c;
}

// ---------------- ANALYSE ----------------
function trend(hist){
let s=hist.slice(-20).reduce((a,b)=>a+b)/20;
let l=hist.slice(-100).reduce((a,b)=>a+b)/100;
return (s-l)/l;
}

function volatility(hist){
let avg=hist.reduce((a,b)=>a+b)/hist.length;
return Math.sqrt(hist.reduce((a,b)=>a+(b-avg)**2,0)/hist.length)/avg;
}

function backtest(hist){
let err=0;
for(let i=hist.length-60;i<hist.length-1;i++){
let pred=hist[i]*(1+trend(hist.slice(0,i)));
err+=Math.abs((pred-hist[i+1])/hist[i+1]);
}
return ((1-err/60)*100).toFixed(1)+"%";
}

function decision(curr,fut,hist){
let t=trend(hist), v=volatility(hist);
if(t>0.05 && fut>curr && v<0.03) return ["üü¢ KAUFEN","Jetzt"];
if(t<-0.05) return ["üî¥ VERKAUFEN","Trend bricht"];
if(v>0.05) return ["üü° WARTEN","Hohe Schwankung"];
return ["‚ö™ HALTEN","Abwarten"];
}

function risk(curr,hist){
let v=volatility(hist)*curr;
return {
sl:(curr-2*v).toFixed(2),
tp:(curr+3*v).toFixed(2)
};
}

// ---------------- PROGNOSE (4 KIs) ----------------
function forecast(hist,days,idx){
let t=trend(hist)*(1+idx*0.25);
let base=hist[hist.length-1];
let res=[];
for(let i=0;i<days;i++){
base*=1+t/Math.sqrt(days);
res.push(base);
}
return res;
}

// ---------------- CHART ----------------
function draw(hist,futs){
if(chart) chart.destroy();
let labels=[];
for(let i=0;i<hist.length;i++) labels.push("-"+(hist.length-i));
for(let i=1;i<=futs[0].length;i++) labels.push("+"+i);

let ds=[{label:"Historie",data:hist,borderColor:"#3b82f6"}];
const cols=["#22c55e","#facc15","#f97316","#38bdf8"];
futs.forEach((f,i)=>{
ds.push({
label:"KI"+(i+1),
data:[...Array(hist.length).fill(null),...f],
borderColor:cols[i],
pointRadius:2
});
});

chart=new Chart(document.getElementById("chart"),{
type:"line",
data:{labels,datasets:ds},
options:{animation:false}
});
}

// ---------------- RUN ----------------
async function run(){
document.getElementById("status").textContent="Analyse l√§uft‚Ä¶";
document.getElementById("progressBar").value=0;

let sym=sel.value;
let days=+document.getElementById("forecastRange").value;
let hist=await fetchHist(sym);
let price=await fetchPrice(sym);

let futs=[];
for(let i=0;i<4;i++){
document.getElementById("progressText").textContent="KI "+(i+1)+" berechnet‚Ä¶";
futs.push(forecast(hist,days,i));
document.getElementById("progressBar").value=(i+1)*25;
}

draw(hist,futs);

let html="";
futs.forEach((f,i)=>{
let last=f[f.length-1];
let dec=decision(price,last,hist);
let r=risk(price,hist);
html+=`
<tr>
<td>KI${i+1}</td>
<td>${last.toFixed(2)}</td>
<td class="${last>price?"buy":"sell"}">${last>price?"‚Üë":"‚Üì"}</td>
<td>${((last-price)/price*100).toFixed(2)}%</td>
<td class="conf">${volatility(hist)<0.03?"Hoch":"Mittel"}</td>
<td class="warning">${volatility(hist)>0.05?"‚ö†Ô∏è Risiko":""}</td>
<td>${backtest(hist)}</td>
<td><b>${dec[0]}</b><br>${dec[1]}</td>
<td>üõë ${r.sl}<br>üéØ ${r.tp}</td>
</tr>`;
});

document.getElementById("out").innerHTML=html;
document.getElementById("status").textContent="Fertig";
document.getElementById("progressText").textContent="Analyse abgeschlossen";
}
</script>

</body>
</html>
