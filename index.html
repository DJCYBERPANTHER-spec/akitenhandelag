<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Asset Finder (Aktien & Krypto)</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: #e5e7eb;
    padding: 20px;
}

h1 {
    color: #38bdf8;
}

.card {
    background: #020617;
    padding: 20px;
    border-radius: 10px;
    max-width: 600px;
}

select, button {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    background: #020617;
    color: #e5e7eb;
    border: 1px solid #334155;
    border-radius: 6px;
}

button {
    cursor: pointer;
    background: #0284c7;
    border: none;
}

button:hover {
    background: #0369a1;
}

.status {
    margin-top: 10px;
    font-size: 14px;
}

small {
    color: #94a3b8;
}
</style>
</head>

<body>

<h1>üìä Asset-Finder (Aktien & Krypto)</h1>

<div class="card">

    <p>Status: <b id="status">Starte Suche‚Ä¶</b></p>
    <p>Gepr√ºft: <b id="checkedCount">0</b></p>
    <p>Gefunden: <b id="foundCount">0</b> / 10</p>
    <p id="eta">‚è≥ Berechne Restzeit‚Ä¶</p>

    <label>Gefundene Assets:</label>
    <select id="assetSelect">
        <option>Suche l√§uft‚Ä¶</option>
    </select>

    <button onclick="openTradingView()">üìà Auf TradingView √∂ffnen</button>

    <small>
        Datenquelle: Finnhub<br>
        Charts/Kauf: TradingView
    </small>

</div>

<script>
/* =====================
   KONFIGURATION
===================== */

const FINNHUB_API_KEY = "d5ohqjhr01qjast6qrjgd5ohqjhr01qjast6qrk0";

const TARGET_COUNT = 10;
const PRIMARY_DAYS = 200;
const FALLBACK_DAYS = 10;
const CHECK_DELAY = 3000;

/* =====================
   ASSET LISTE
===================== */

const ALL_ASSETS = [
    { symbol: "AAPL", name: "Apple Inc." },
    { symbol: "MSFT", name: "Microsoft Corporation" },
    { symbol: "NVDA", name: "NVIDIA Corporation" },
    { symbol: "AMZN", name: "Amazon.com Inc." },
    { symbol: "GOOGL", name: "Alphabet Inc." },
    { symbol: "META", name: "Meta Platforms Inc." },
    { symbol: "TSLA", name: "Tesla Inc." },

    { symbol: "BINANCE:BTCUSDT", name: "Bitcoin" },
    { symbol: "BINANCE:ETHUSDT", name: "Ethereum" },
    { symbol: "BINANCE:SOLUSDT", name: "Solana" },
    { symbol: "BINANCE:BNBUSDT", name: "Binance Coin" },
    { symbol: "BINANCE:ADAUSDT", name: "Cardano" }
];

/* =====================
   VARIABLEN
===================== */

let found = [];
let checked = 0;
let index = 0;
let minDays = PRIMARY_DAYS;
let startTime = Date.now();
let searching = true;

const assetSelect = document.getElementById("assetSelect");

/* =====================
   HILFSFUNKTIONEN
===================== */

function setStatus(t){ document.getElementById("status").textContent = t; }
function updateCounters(){
    document.getElementById("checkedCount").textContent = checked;
    document.getElementById("foundCount").textContent = found.length;
}
/* =====================
   HISTORIE PR√úFEN
===================== */

async function hasHistory(symbol, days){
    const to = Math.floor(Date.now()/1000);
    const from = to - days*86400;

    const url = `https://finnhub.io/api/v1/stock/candle?symbol=${encodeURIComponent(symbol)}&resolution=D&from=${from}&to=${to}&token=${FINNHUB_API_KEY}`;

    const r = await fetch(url);
    const d = await r.json();

    return d.s === "ok" && d.c && d.c.length >= days;
}

/* =====================
   ETA BERECHNUNG
===================== */

function updateETA(){
    const elapsed = (Date.now() - startTime) / 1000;
    const avg = checked > 0 ? elapsed / checked : 0;
    const remaining = Math.max((TARGET_COUNT - found.length) * avg, 0);

    document.getElementById("eta").textContent =
        `‚è≥ ca. ${Math.ceil(remaining)} Sekunden verbleibend`;
}

/* =====================
   ASSET SUCHE
===================== */

async function searchAssets(){
    setStatus("Suche Assets‚Ä¶");

    while(searching){
        if(index >= ALL_ASSETS.length){
            if(minDays > FALLBACK_DAYS){
                minDays = FALLBACK_DAYS;
                index = 0;
                setStatus("Fallback auf 10 Tage Historie‚Ä¶");
            } else {
                setStatus("Suche beendet");
                searching = false;
                break;
            }
        }

        const asset = ALL_ASSETS[index];
        index++;
        checked++;
        updateCounters();
        updateETA();

        try{
            const ok = await hasHistory(asset.symbol, minDays);
            if(ok && !found.find(a=>a.symbol===asset.symbol)){
                found.push(asset);
                addToDropdown(asset);
                updateCounters();
                if(found.length >= TARGET_COUNT){
                    setStatus("‚úÖ Genug Assets gefunden");
                    searching = false;
                    break;
                }
            }
        }catch(e){}

        await sleep(CHECK_DELAY);
    }
}

/* =====================
   DROPDOWN
===================== */

function addToDropdown(asset){
    if(found.length === 1){
        assetSelect.innerHTML = "";
    }
    const o = document.createElement("option");
    o.value = asset.symbol;
    o.textContent = asset.name;
    assetSelect.appendChild(o);
}

/* =====================
   TRADINGVIEW LINK
===================== */

function openTradingView(){
    const sym = assetSelect.value;
    if(!sym) return;

    let url;
    if(sym.startsWith("BINANCE:")){
        url = `https://www.tradingview.com/chart/?symbol=${sym}`;
    } else {
        url = `https://www.tradingview.com/chart/?symbol=NASDAQ:${sym}`;
    }
    window.open(url, "_blank");
}

/* =====================
   HILFSFUNKTION
===================== */

function sleep(ms){
    return new Promise(r=>setTimeout(r, ms));
}

/* =====================
   AUTOSTART
===================== */

searchAssets();
</script>

</body>
</html>
