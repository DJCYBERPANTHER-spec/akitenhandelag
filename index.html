<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Multi-Asset Analyse (Aktien & Krypto) ‚Äì CHF</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{background:#0f172a;color:#e5e7eb;font-family:Arial;padding:15px}
h1{text-align:center}
.subtitle{text-align:center;color:#94a3b8;font-size:0.9rem}
.controls{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin:12px 0}
select,button{background:#020617;color:#e5e7eb;border:1px solid #22c55e;padding:8px 12px;border-radius:6px}
button:hover{background:#22c55e;color:#020617;cursor:pointer}
canvas{background:#020617;border-radius:10px;margin-top:15px}
table{width:100%;border-collapse:collapse;margin-top:15px;font-size:0.85rem}
th,td{border:1px solid #22c55e;padding:6px;text-align:center}
.buy{color:#22c55e;font-weight:bold}
.sell{color:#ef4444;font-weight:bold}
.hold{color:#facc15;font-weight:bold}
.footer{text-align:center;font-size:0.75rem;color:#94a3b8;margin-top:12px}
#currentPrice{text-align:center;margin:8px 0;font-weight:bold}
progress{width:80%;height:16px}
</style>
</head>

<body>

<h1>üìä Multi-Asset Analyse</h1>
<div class="subtitle">Aktien & Kryptow√§hrungen ¬∑ CHF ¬∑ echte Marktdaten</div>

<div class="controls">
<select id="asset"></select>
<select id="forecastDays">
  <option value="1">1 Tag</option>
  <option value="7">7 Tage</option>
  <option value="30">30 Tage</option>
  <option value="90">90 Tage</option>
</select>
<button onclick="runAnalysis()">Analyse starten</button>
</div>

<div id="status" style="text-align:center">Bereit</div>
<div id="currentPrice"></div>

<div style="text-align:center">
<progress id="progress" value="0" max="100"></progress>
</div>

<canvas id="chart" height="260"></canvas>

<table>
<thead>
<tr>
<th>Modell</th>
<th>Prognose (CHF)</th>
<th>Signal</th>
<th>√Ñnderung</th>
<th>Aktion</th>
</tr>
</thead>
<tbody id="tableBody">
<tr><td colspan="5">Warte auf Analyse‚Ä¶</td></tr>
</tbody>
</table>

<div class="footer">‚ö†Ô∏è Keine Anlageberatung ‚Äì Analysezwecke</div>

<script>
/* =========================
   ASSETS (Aktien + Kryptos)
========================= */
const ASSETS = [
  {symbol:"AAPL", name:"Apple", type:"stock"},
  {symbol:"MSFT", name:"Microsoft", type:"stock"},
  {symbol:"NVDA", name:"NVIDIA", type:"stock"},
  {symbol:"BTC-USD", name:"Bitcoin", type:"crypto"},
  {symbol:"ETH-USD", name:"Ethereum", type:"crypto"},
  {symbol:"SOL-USD", name:"Solana", type:"crypto"}
];

const assetSelect = document.getElementById("asset");
ASSETS.forEach(a=>{
  const o=document.createElement("option");
  o.value=a.symbol;
  o.textContent=`${a.name} (${a.symbol})`;
  assetSelect.appendChild(o);
});

/* =========================
   GLOBALE VARIABLEN
========================= */
let chart=null;
let worker=null;

/* =========================
   YAHOO PRICE FETCH (CHF)
========================= */
async function fetchYahoo(symbol){
  const url=`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?range=1y&interval=1d`;
  const res=await fetch(url);
  const json=await res.json();
  const r=json.chart.result[0];
  const prices=r.indicators.quote[0].close.filter(v=>v);
  return prices;
}

async function fetchCHF(){
  const r=await fetch("https://api.exchangerate.host/latest?base=USD&symbols=CHF");
  const j=await r.json();
  return j.rates.CHF;
}

/* =========================
   CHART
========================= */
function drawChart(hist, forecast){
  if(chart) chart.destroy();
  const labels=[...hist.map((_,i)=>`-${hist.length-i}d`),...forecast.map((_,i)=>`+${i+1}d`)];
  chart=new Chart(document.getElementById("chart"),{
    type:"line",
    data:{
      labels,
      datasets:[
        {label:"Historie",data:hist,borderColor:"#3b82f6"},
        {label:"Prognose",data:[...Array(hist.length).fill(null),...forecast],borderColor:"#22c55e"}
      ]
    },
    options:{responsive:true,animation:false}
  });
}

/* =========================
   ANALYSE START
========================= */
async function runAnalysis(){
  document.getElementById("status").textContent="Lade Marktdaten‚Ä¶";
  document.getElementById("progress").value=20;

  const sym=assetSelect.value;
  const days=+document.getElementById("forecastDays").value;

  const prices=await fetchYahoo(sym);
  const chf=await fetchCHF();
  const pricesCHF=prices.map(p=>p*chf);

  const current=pricesCHF[pricesCHF.length-1];
  document.getElementById("currentPrice").textContent=
    `Aktueller Kurs: ${current.toFixed(2)} CHF`;

  document.getElementById("progress").value=50;
  document.getElementById("status").textContent="KI wird gestartet‚Ä¶";

  if(!worker){
    worker=new Worker("lstm-worker.js");
    worker.onmessage=e=>{
      const forecast=e.data;
      finishAnalysis(pricesCHF,forecast);
    };
  }

  worker.postMessage({prices:pricesCHF,days});
}

/* =========================
   ERGEBNIS
========================= */
function finishAnalysis(hist,forecast){
  drawChart(hist,forecast);

  const last=forecast[forecast.length-1];
  const curr=hist[hist.length-1];
  let signal="HALTEN",cls="hold";
  if(last>curr*1.02){signal="KAUFEN";cls="buy";}
  if(last<curr*0.98){signal="VERKAUFEN";cls="sell";}

  document.getElementById("tableBody").innerHTML=`
    <tr>
      <td>LSTM-KI</td>
      <td>${last.toFixed(2)}</td>
      <td class="${cls}">${signal}</td>
      <td>${((last-curr)/curr*100).toFixed(2)}%</td>
      <td>${signal}</td>
    </tr>
  `;

  document.getElementById("progress").value=100;
  document.getElementById("status").textContent="Analyse abgeschlossen ‚úî";
}
</script>

</body>
</html>
